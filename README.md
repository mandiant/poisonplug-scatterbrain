# Overview

The repo contains the code that comprises a Python library that provides all of the facilities to comprehensively deobfuscate binaries protected by SHADOWPAD’s ScatterBrain obfuscator outlined in our blog post: [NOTE: temporary internal link](https://docs.google.com/document/d/1Qmu27BtNC5jF6R50TcWPP4zcb2ch5dewxY8Hi6fyprY/edit?tab=t.0). The core logic amounts to taking a protected ScatterBrain-produced binary and producing a new functional binary, completely free of any protections. This is achieved through a series of _deobfuscation passes_ until the final, deobfuscated state is achieved. This state is then converted to a fully functional executable e.g. exe, dll.  It works for all known ScatterBrain components that we uncovered, which include droppers, backdoors, and any SHADOWPAD plugins. 

The library encapsulates the input as a `ProtectedInput` image, which is an object that knows how to properly parse ScatterBrain-produced binaries and prepares the object for all subsequent deobfuscation passes. It uses a `ProtectionType` property which identifies the protection mode utilized by the obfuscator for the provided input. The core primitives for all of this can be found in the `recover_core.py` Python file. The deobfuscation passes are implemented in other Python files prefixed with recover e.g.
- `recover_cfg.py`: Provides the APIs required to remove every control flow graph (CFG) obfuscation the obfuscator employs. This is driven via a set of “mutation rules”, which are “guides” that facilitate a “stepping” (stepping as in the debugger terminology, of ‘_stepping one instruction at a time_’) approach to removing all  CFG obfuscations.
- `recover_dispatchers.py`: Provides the APIs responsible for the “Instruction Dispatcher” protection the obfuscator employs. 
- `recover_functions.py`: Provides the APIs responsible for recovering and rebuilding the original functions that were protected by the obfuscator.
- `recover_imports.py`:  Provides the APIs  able to break the import obfuscation protection employed by the obfuscator and produce a new import table
- `recover_output64.py`: Provides the APIs that produce the final deobfuscated image output, which includes the new import table and accounting for all aspects to ensure the output binary is functional e.g. it can still be executed successfully with all initial logic intact.
